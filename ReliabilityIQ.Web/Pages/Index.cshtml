@page "/"
@model IndexModel
@{
    ViewData["Title"] = "Runs";
}

<section class="mb-3">
    <h1 class="h3 mb-2">Scan Runs</h1>
    <p class="text-body-secondary mb-0">Select a run to view findings and summaries.</p>
</section>

@if (Model.Runs.Count == 0)
{
    <div class="alert alert-warning mb-0" role="alert">
        No scan runs were found in the configured database.
    </div>
}
else
{
    <div class="table-responsive">
        <table id="runsTable" class="table table-striped table-hover align-middle">
            <thead>
            <tr>
                <th>Run ID</th>
                <th>Repo Root</th>
                <th>Commit</th>
                <th>Started (UTC)</th>
                <th>Ended (UTC)</th>
                <th>Tool</th>
                <th>Findings</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            @foreach (var run in Model.Runs)
            {
                <tr>
                    <td class="font-monospace small">@run.RunId</td>
                    <td class="font-monospace small">@run.RepoRoot</td>
                    <td class="font-monospace small">@(string.IsNullOrWhiteSpace(run.CommitSha) ? "-" : run.CommitSha)</td>
                    <td>@run.StartedAt.UtcDateTime.ToString("yyyy-MM-dd HH:mm:ss")</td>
                    <td>@(run.EndedAt?.UtcDateTime.ToString("yyyy-MM-dd HH:mm:ss") ?? "-")</td>
                    <td>@run.ToolVersion</td>
                    <td>
                        <span class="badge text-bg-danger me-1">E @run.ErrorCount</span>
                        <span class="badge text-bg-warning text-dark me-1">W @run.WarningCount</span>
                        <span class="badge text-bg-info text-dark">I @run.InfoCount</span>
                    </td>
                    <td>
                        <a asp-page="/Run/Findings" asp-route-runId="@run.RunId" class="btn btn-sm btn-outline-primary">Open</a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}

@section Scripts
{
    <script>
        const table = document.querySelector("#runsTable");
        if (table) {
            new DataTable("#runsTable", {
                pageLength: 25,
                order: [[3, "desc"]],
                columnDefs: [
                    { targets: [7], orderable: false }
                ]
            });
        }
    </script>
}
